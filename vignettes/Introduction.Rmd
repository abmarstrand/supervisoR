
title: "Introduction to supervisoR"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Introduction}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

# Introduction

supervisoR is an R package designed for visualizing the enrichment of biological pathways and/or genes across conditions. This vignette explains the basic functionalities of the package, guiding you through data preparation and various visualization techniques.

# Installing and loading the package

```{r setup}
#devtools::install("supervisoR")
library(supervisoR)
library(magrittr)
```

# Data preparation
## Loading Gene Sets and building Pathway Graph
```{r}
# Load the default data for analyses (MsigDB human REACTOME dataset). This data is already preprocessed.
default_data <- load_default_data()

# Extract components from the loaded data
gene_sets <- default_data$gene_sets
relations <- default_data$relations
trans <- data.frame(
  gene_sets_name = default_data$mapping$processed_name,
  relation_name = default_data$mapping$exactSource,
  stringsAsFactors = FALSE
)

# Preprocess gene sets using the mapping and relations
preprocessed_data <- load_and_preprocess_gene_sets(
  gene_sets = gene_sets,
  pathways_relation = relations,
  translation_layer = trans
)

# Unpack the preprocessed data
gene_sets <- preprocessed_data$gene_sets
mapping <- preprocessed_data$mapping
g <- preprocessed_data$pathway_graph
```

## Loading Example Enrichment Scores
```{r}
# Load example dataset. Note that the example data was randomly generated using rnorm(length(gene_sets), sd = 0.25)
# and thus does not reflect real conditions or output from a pathway analysis.
data("ex_data")
enrichment_scores <- ex_data
conditions <- colnames(enrichment_scores)
```

# Visualizing Pathways
## Plotting a Subgraph with Glyphs
```{r}
# Define the parent pathway name
parent_name <- "Signaling By Tgfb Family Members"    

# Plotting multiple conditions
plot_subgraph(
  parent_geneset_name = parent_name,
  enrichment_scores = enrichment_scores,
  conditions = conditions,
  mapping = mapping,
  g = g,
  gene_sets = gene_sets,
  layout = "kk",
  hide_nodes_without_enrichment = TRUE,
  enrichment_limits = NULL,
  use_node_label = TRUE
)
```

## Plotting multiple conditions relative to Condition 1
You can visualize enrichment scores relative to a specific reference condition by specifying the reference parameter.
```{r}
# Plotting multiple conditions relative to Condition 1
plot_subgraph(
  parent_geneset_name = parent_name,
  enrichment_scores = enrichment_scores,
  conditions = conditions,
  mapping = mapping,
  g = g,
  gene_sets = gene_sets,
  layout = "kk",
  hide_nodes_without_enrichment = TRUE,
  enrichment_limits = NULL,
  use_node_label = TRUE,
  reference = "Condition.1"
)
```

## Adjusting Edge Thickness and Adding Percentage Labels
Enhance the visualization by adjusting edge thickness based on gene overlap and adding percentage labels to edges.
```{r}
# Plotting multiple conditions relative to Condition 1 with edge thickness and labels
plot_subgraph(
  parent_geneset_name = parent_name,
  enrichment_scores = enrichment_scores,
  conditions = conditions,
  mapping = mapping,
  g = g,
  gene_sets = gene_sets,
  layout = "kk",
  hide_nodes_without_enrichment = TRUE,
  enrichment_limits = NULL,
  use_node_label = TRUE,
  reference = "Condition.1",
  adjust_edge_thickness = TRUE,
  edge_percentage_labels = TRUE
)
```

## Coloring Edges by Depth from the Root Node
Further customize the plot by coloring edges based on their depth from the root node, providing additional insight into the pathway hierarchy.

```{r}
# Plotting multiple conditions relative to Condition 1 with edge thickness, labels, and color by depth
plot_subgraph(
  parent_geneset_name = parent_name,
  enrichment_scores = enrichment_scores,
  conditions = conditions,
  mapping = mapping,
  g = g,
  gene_sets = gene_sets,
  layout = "kk",
  hide_nodes_without_enrichment = TRUE,
  enrichment_limits = NULL,
  use_node_label = TRUE,
  reference = "Condition.1",
  adjust_edge_thickness = TRUE,
  edge_percentage_labels = TRUE,
  color_by_depth = TRUE
)
```
## Plotting a Subgraph with a Single Condition
Focus on a single condition to explore specific pathway enrichments without the complexity of multiple comparisons.

```{r}
# Plotting a subgraph for a single condition
plot_subgraph(
  parent_geneset_name = "Metabolism Of Lipids" ,
  enrichment_scores = enrichment_scores,
  conditions = "Condition.3",
  mapping = mapping,
  g = g,
  gene_sets = gene_sets,
  layout = "fr",
  hide_nodes_without_enrichment = TRUE,
  enrichment_limits = NULL,
  use_node_label = TRUE
)
```

## Using a shiny app to explore the full pathway set. 
If you don't know where to start, a shiny app is available to explore the pathway set interactively. This includes most of the options found in the static plots.
```{r}
run_pathway_shiny_app(enrichment_scores,        
                      conditions,               
                      mapping,                   
                      g,                         
                      gene_sets,                 
                      enrichment_limits = NULL,  
                      glyph_size = c(80, 60),   
                      res = 96
    )
```
# Conclusion
This vignette demonstrated how to use supervisoR's functions to visualize pathway enrichment data. The unified plot_subgraph function provides a flexible and efficient way to generate insightful visualizations tailored to your specific analytical needs. For more detailed information, refer to the function documentation and explore additional customization options.
